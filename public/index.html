<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#667eea" />
    <meta name="description" content="CEI - Controle Escolar Inteligente - Sistema de GestÃ£o de Biblioteca e PatrimÃ´nio" />
    
    <!-- Prevenir Cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="CEI" />
    <meta name="mobile-web-app-capable" content="yes" />
    
    <title>CEI - Controle Escolar Inteligente</title>
    
    <!-- ForÃ§ar atualizaÃ§Ã£o - versÃ£o com ISBN obrigatÃ³rio -->
    <script>
      // VersÃ£o do sistema
      window.CEI_VERSION = '3.3.1';
      window.CEI_BUILD = Date.now();
      
      console.log('ðŸš€ CEI v3.3.1 - SeleÃ§Ã£o de Leitor Corrigida');
      
      // Limpar cache ao carregar
      if ('caches' in window) {
        caches.keys().then(keys => {
          keys.forEach(key => {
            caches.delete(key);
            console.log('ðŸ—‘ï¸ Cache removido:', key);
          });
        });
      }
      
      // Desregistrar TODOS os service workers
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          registrations.forEach(reg => {
            reg.unregister();
            console.log('ðŸ—‘ï¸ Service Worker desregistrado');
          });
        });
      }
      
      // Limpar localStorage de versÃ£o e forÃ§ar atualizaÃ§Ã£o
      const savedVersion = localStorage.getItem('cei_app_version');
      if (savedVersion !== '3.3.0') {
        console.log('ðŸ”„ Atualizando de', savedVersion, 'para 3.3.0');
        localStorage.setItem('cei_app_version', '3.3.0');
        localStorage.setItem('cei_force_reload', 'true');
      }
      
      // ForÃ§ar reload completo na primeira carga da nova versÃ£o
      window.addEventListener('load', () => {
        const forceReload = localStorage.getItem('cei_force_reload');
        if (forceReload === 'true') {
          localStorage.removeItem('cei_force_reload');
          console.log('ðŸ”„ ForÃ§ando reload completo com hard refresh...');
          setTimeout(() => {
            location.replace(location.href.split('?')[0] + '?v=3.3.0&t=' + Date.now());
          }, 1000);
        }
      });
    </script>
    
    <!-- Mercado Pago SDK para tokenizaÃ§Ã£o de cartÃµes -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
  </head>
  <body>
    <noscript>VocÃª precisa habilitar JavaScript para usar este aplicativo.</noscript>
    <div id="root"></div>
  </body>
</html>
